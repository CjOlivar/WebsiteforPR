<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>

    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="./css/styles2.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-qrcode/1.0/jquery.qrcode.min.js"></script>

</head>
<body>

    <!-- Header Section -->
    <header>
        <div class="logo-container">
            <div class="logo">
                <a href="https://www.sti.edu" target="_blank">
                    <img src="./Images/stilogo.png" alt="Logo">
                </a>
            </div>
            <div class="title">
                <a href="homepage.html" target="_blank" style="color: inherit; text-decoration: none;">
                    uniSTIque
                </a>
            </div>
        </div>

    <!-- Search Bar and Cart -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search for products..." />
    </div>
    
    <div class="cart-container">
        <img src="./Images/shoppingcarticon.png" alt="Shopping Cart" class="cart-icon" onclick="viewCart()">
        <span id="cartCount" class="cart-count">0</span>
    </div>
    <!-- User Profile Icon -->
    <div class="profile-container">
        <img src="./Images/usericon.png" alt="User Icon" class="user-icon" onclick="toggleProfileDropdown()" aria-label="User Profile Menu">
        <!-- Profile Dropdown -->
        <div id="profileDropdown" class="profile-dropdown">
            <a href="profile.html">Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
        </div>
    </div>
    
    </header>

    <!-- Recommendations Section -->
    <section class="recommendations">
        <h2>Recommended for You</h2>
        <div class="recommendation product-item" data-price="200" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('daily-uniform.png', 'Daily Uniform', 200, true, 10)">
            <img src="./Images/daily-uniform.png" alt="Recommended Product">
            <p>Daily Uniform</p>
        </div>
        <div class="recommendation product-item" data-price="250" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('pe-uniform.png', 'PE Uniform', 250, true, 10)">
            <img src="./Images/pe-uniform.png" alt="Recommended Product">
            <p>PE Uniform</p>
        </div>
    </section>

    <!-- Available Section -->
<section class="available-section">
    <h2>Available:</h2>
    <div class="available-slider">
        <div class="available-items-wrapper">
            <div class="available-items">
                <div class="product-item" data-price="200" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('./Images/daily-uniform.png', 'Daily Uniform', 200, true, 10)">
                    <img src="./Images/daily-uniform.png" alt="Daily Uniform">
                    <p>ㅤDaily Uniformㅤ</p>
                </div>
                <div class="product-item" data-price="40" data-requires-size="false" data-requires-gender="false" data-max-qty="10" onclick="openModal('./Images/id-lace.png', 'ID Lace', 40, false, 10)">
                    <img src="./Images/id-lace.png" alt="ID Lace">
                    <p>ㅤㅤㅤID Laceㅤㅤㅤ</p>
                </div>
                <div class="product-item" data-price="250" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('./Images/pe-uniform.png', 'PE Uniform', 250, true, 10)">
                    <img src="./Images/pe-uniform.png" alt="PE Uniform">
                    <p>ㅤㅤPE Uniformㅤㅤ</p>
                </div>
                <div class="product-item" data-price="10" data-requires-size="false" data-requires-gender="false" data-max-qty="10" onclick="openModal('./Images/sti-pin.png', 'Pin', 10, false, 10)">
                    <img src="./Images/sti-pin.png" alt="Pin">
                    <p>ㅤㅤㅤㅤPinㅤㅤㅤㅤ</p>
                </div>
                <div class="product-item" data-price="450" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('./Images/blue-jacket.png', 'Blue Hooded Jacket', 450, true, 10)">
                    <img src="./Images/blue-jacket.png" alt="Blue Hooded Jacket">
                    <p>Blue Hooded Jacket</p>
                </div>
                <div class="product-item" data-price="450" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('./Images/grey-jacket.png', 'Grey Hooded Jacket', 450, true, 10)">
                    <img src="./Images/grey-jacket.png" alt="Grey Hooded Jacket">
                    <p>Grey Hooded Jacket</p>
                </div>
                <div class="product-item" data-price="275" data-requires-size="true" data-requires-gender="true" data-max-qty="10" onclick="openModal('./Images/polo-shirt.png', 'Alumni Poloshirt', 275, true, 10)">
                    <img src="./Images/polo-shirt.png" alt="Alumni Poloshirt">
                    <p>Alumni Poloshirt</p>
                </div>
                <div class="product-item" data-price="650" data-requires-size="false" data-requires-gender="false" data-max-qty="10" onclick="openModal('Untitled design.png', 'Aqua Flask', 650, false, 10)">
                    <img src="Untitled design.png" alt="Aqua Flask">
                    <p>ㅤㅤAqua Flaskㅤㅤ</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- News Section -->
<div class="news-section">
    <h2>New Products</h2>
    <div class="news-slider">
        <div class="news-slide">
            <img src="./Images/polo-shirt.png" alt="News Image 1">
            <div class="news-info">
                <h3>Alumni Poloshirt</h3>
                <p>New Polo shirt in stock</p>
                <a href="https://alumni.sti.edu/alumni-shop.asp">Read More</a>
            </div>
        </div>
        <div class="news-slide">
            <img src="./Images/grey-jacket.png" alt="News Image 2">
            <div class="news-info">
                <h3>Grey Hooded Jacket</h3>
                <p>New Grey jacket in stock</p>
                <a href="https://alumni.sti.edu/alumni-shop.asp">Read More</a>
            </div>
        </div>
        <div class="news-slide">
            <img src="./Images/blue-jacket.png" alt="News Image 3">
            <div class="news-info">
                <h3>Blue Hooded Jacket</h3>
                <p>New Blue jacket in stock</p>
                <a href="https://alumni.sti.edu/alumni-shop.asp">Read More</a>
            </div>
        </div>
    </div>
    <div class="news-slider-controls">
        <button class="prev" onclick="moveSlide(-1)">&lt;</button>
        <button class="next" onclick="moveSlide(1)">&gt;</button>
    </div>
</div>


    <!-- Modal for Available Item --> 
    <div id="availableModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="modalImage" src="" alt="Product Image">
            <div id="caption"></div>
            <div class="modal-details">
                <p id="productPrice"></p>
                <div id="genderContainer" style="display: none;">
                    <label for="genderSelect">Select Gender:</label>
                    <select id="genderSelect">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                    <br>
                </div>
                <div id="sizeContainer" style="display: none;">
                    <label for="sizeSelect">Select Size:</label>
                    <select id="sizeSelect">
                        <option value="small">Small</option>
                        <option value="medium">Medium</option>
                        <option value="large">Large</option>
                        <option value="xl">XL</option>
                        <option value="2xl">2XL</option>
                    </select>
                    <br>
                </div>
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" value="1" min="1">
                <p id="quantityError" style="color: red; display: none;"></p>
                <br>
                <button class="cta-button" onclick="buyNow()">Buy Now</button>
            </div>
        </div>
    </div>
    

<!-- Modal for Shopping Cart -->
<div id="cartModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeCartModal()">&times;</span>
        <h2>Shopping Cart</h2>
        <div id="cartItems"></div>
        <div id="cartTotal">
            <p>Total: ₱<span id="totalAmount">0</span></p>
        </div>
        <button class="cta-button" onclick="checkout()">Checkout</button>
    </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closePaymentModal()">&times;</span>
        <h2>Select Payment Method</h2>
        <div class="payment-methods">
            <div class="payment-option" onclick="selectPaymentMethod('gcash')">
                <img src="./Images/gcash-logo.png" alt="GCash" class="payment-icon">
                <span>GCash</span>
            </div>
            <div class="payment-option" onclick="selectPaymentMethod('credit_card')">
                <img src="./Images/creditcard-icon.png" alt="Credit Card" class="payment-icon">
                <span>Credit Card</span>
            </div>
            <div class="payment-option" onclick="selectPaymentMethod('paymaya')">
                <img src="./Images/PayMaya-Logo.png" alt="PayMaya" class="payment-icon">
                <span>PayMaya</span>
            </div>
            <div class="payment-option" onclick="selectPaymentMethod('qr_code')">
                <img src="./Images/qr-code.png" alt="QR Code" class="payment-icon">
                <span>QR Code</span>
            </div>
            <!-- Add Cash Option -->
            <div class="payment-option" onclick="selectPaymentMethod('cash')">
                <img src="./Images/cash-logo.png" alt="Cash" class="payment-icon">
                <span>Cash</span>
            </div>
        </div>
        <div id="paymentDetails"></div>
    </div>
    <div id="qrCodeContainer" style="margin-top: 20px;"></div>
</div>


    <!-- Modal for Profile -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeProfileModal()">&times;</span>
        <h2>User Profile</h2>
        <p>Welcome, User</p>
        <p>Email: user2314@example.com</p>
        <p>Role: Student</p>
        <!-- Add more profile details here if needed -->
    </div>
</div>

    <!-- Footer Section -->
    <footer>
        <div class="footer-links">
            <a href="easter egg.jpg">Terms & Conditions</a>
            <a href="#">Privacy Policy</a>
        </div>
        <div class="social-media">
            <a href="https://www.facebook.com/calamba.sti.edu" target="_blank">
                <img src="./Images/fbicon.png" alt="Facebook">
            </a>
            <a href="https://www.youtube.com/@STIdotEdu" target="_blank">
                <img src="./Images/yticon.png" alt="YouTube">
            </a>
            <a href="https://www.tiktok.com/@sti.edu" target="_blank">
                <img src="./Images/tiktokicon.png" alt="TikTok">
            </a>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        let cartCount = 0;
let cartItems = [];
let totalAmount = 0;
let maxQuantity = 0;
let slideIndex = 0;
showSlides(slideIndex);

function openModal(imageSrc, productName, price, requiresSize, maxQty) {
    document.getElementById("modalImage").src = imageSrc;
    document.getElementById("caption").innerHTML = productName;
    document.getElementById("productPrice").innerHTML = "Price: ₱" + price;
    maxQuantity = maxQty;  


    document.getElementById('sizeContainer').style.display = requiresSize ? 'block' : 'none';


    const productItem = event.currentTarget;
    const requiresGender = productItem.getAttribute('data-requires-gender') === 'true';
    document.getElementById('genderContainer').style.display = requiresGender ? 'block' : 'none';

    document.getElementById('availableModal').style.display = 'block';
}

function closeModal() {
    document.getElementById("availableModal").style.display = "none";  
}

function buyNow() {
    const size = document.getElementById("sizeContainer").style.display === "block" ? document.getElementById("sizeSelect").value : null;
    const quantityInput = document.getElementById("quantity").value;
    const quantity = parseInt(quantityInput);
    const productName = document.getElementById("caption").innerHTML;
    const priceText = document.getElementById("productPrice").innerText;
    const price = parseInt(priceText.replace('Price: ₱', ''));
    const quantityError = document.getElementById("quantityError");

    
    if (isNaN(quantity) || quantity <= 0) {
        quantityError.innerText = "Please enter a valid quantity.";
        quantityError.style.display = "block";
        return;
    }

    if (quantity > maxQuantity) {
        quantityError.innerText = `Maximum quantity for ${productName} is ${maxQuantity}.`;
        quantityError.style.display = "block";
        return;
    } else {
        quantityError.style.display = "none";
    }

    cartCount += quantity;
    totalAmount += price * quantity;
    document.getElementById("cartCount").innerText = cartCount;

    cartItems.push({ productName, price, size, quantity });
    closeModal();  
}

function viewCart() {
    const cartItemsContainer = document.getElementById("cartItems");
    cartItemsContainer.innerHTML = '';

    cartItems.forEach(item => {
        const cartItemDiv = document.createElement("div");
        cartItemDiv.classList.add("cart-item");
        cartItemDiv.innerHTML = `
            <p>${item.productName} - ₱${item.price} x ${item.quantity}${item.size ? ' (Size: ' + item.size + ')' : ''}</p>
        `;
        cartItemsContainer.appendChild(cartItemDiv);
    });

    document.getElementById("totalAmount").innerText = totalAmount;
    document.getElementById("cartModal").style.display = "block";  
}

function closeCartModal() {
    document.getElementById("cartModal").style.display = "none";  
}

function checkout() {
    if (cartItems.length === 0) {
        alert("Your cart is empty!");
        return;
    }

    // Get modal elements
    const paymentModal = document.getElementById("paymentModal");
    const cartModal = document.getElementById("cartModal");

    // Close cart modal
    cartModal.style.display = "none"; 
    paymentModal.style.display = "block"; 
    clearPaymentDetails();
}

// Close payment modal when clicking outside of it
window.onclick = function (event) {
    const paymentModal = document.getElementById("paymentModal");
    if (event.target == paymentModal) {
        paymentModal.style.display = "none";
        clearPaymentDetails();
    }
};

function selectPaymentMethod(method) {
    clearPaymentDetails();

    const paymentDetailsContainer = document.getElementById("paymentDetails");
    const qrCodeContainer = document.getElementById("qrCodeContainer"); 

    switch (method) {
        case "gcash":
            paymentDetailsContainer.innerHTML = `<h3>GCash Payment</h3>
                <p>Scan the QR code with your GCash app.</p>`;
            generateQRCode(`gcash://pay?amount=${totalAmount}&message=Your+Order`);
            break;

        case "credit_card":
            paymentDetailsContainer.innerHTML = ` 
            <h3>Credit Card Details</h3>
            <label for="cardNumber">Card Number:</label>
            <input type="text" id="cardNumber" placeholder="Enter card number">
            <br>
            <label for="expiryDate">Expiry Date:</label>
            <input type="date" id="expiryDate" placeholder="Select expiry date">
            <br>
            <label for="cardCvv">CVV:</label>
            <input type="text" id="cardCvv" placeholder="Enter CVV">
        `;
            qrCodeContainer.innerHTML = ''; 
            break;

        case "paymaya":
            paymentDetailsContainer.innerHTML = `<h3>PayMaya Payment</h3>
                <p>Use the PayMaya app to complete your payment.</p>`;
            generateQRCode(`paymaya://pay?amount=${totalAmount}&message=Your+Order`);
            break;

        case "qr_code":
            paymentDetailsContainer.innerHTML = `<h3>QR Code Payment</h3>
                <p>Scan the QR code to proceed with your payment.</p>`;
            generateQRCode(`payment://process?amount=${totalAmount}&message=Your+Order`);
            break;

        case "cash":
            paymentDetailsContainer.innerHTML = `<h3>Cash Payment</h3>
                <p>You have selected cash as your payment method. Please prepare the exact amount of ₱${totalAmount} for cash on delivery or in-store payment.</p>
                <button onclick="submitPayment('cash')">Confirm Cash Payment</button>`;
            qrCodeContainer.innerHTML = ''; 
            break;

        default:
            paymentDetailsContainer.innerHTML = '';
            qrCodeContainer.innerHTML = ''; 
    }
}


function generateQRCode(data) {
    const qrCodeContainer = document.getElementById("qrCodeContainer");
    QRCode.toCanvas(qrCodeContainer, data, function (error) {
        if (error) console.error(error);
        console.log('QR code generated successfully!');
    });
}

function clearPaymentDetails() {
    const paymentDetailsContainer = document.getElementById("paymentDetails");
    paymentDetailsContainer.innerHTML = '';
    document.getElementById("qrCodeContainer").innerHTML = ''; 
}

function submitPayment(method) {
    let isValid = true;
    let paymentInfo = {};

    switch (method) {
        case "credit_card":
            const cardNumber = document.getElementById("cardNumber").value;
            const expiryDate = document.getElementById("expiryDate").value;
            const cvv = document.getElementById("cvv").value;

            if (!cardNumber || !expiryDate || !cvv) {
                alert("Please fill out all fields.");
                isValid = false;
            } else {
                paymentInfo = {
                    method: "Credit Card",
                    cardNumber,
                    expiryDate,
                    cvv,
                };
            }
            break;

        case "gcash":
        case "paymaya":
        case "qr_code":
            paymentInfo = { method };
            break;

            case "cash":
                paymentInfo = { method: "Cash" };
                alert("Cash payment confirmed. Please prepare the exact amount at Proware.");
                break;

        default:
            isValid = false;
            alert("Invalid payment method selected.");
    }

    if (isValid) {
        console.log("Processing payment:", paymentInfo);
        alert("Payment successful! Thank you for your purchase.");
        clearCart(); 
    }
}

function clearCart() {
    cartCount = 0;
    totalAmount = 0;
    cartItems = [];

    document.getElementById("cartCount").innerText = cartCount;
    document.getElementById("totalAmount").innerText = totalAmount;
    document.getElementById("cartItems").innerHTML = '';  

    closePaymentModal();
}

function closePaymentModal() {
    document.getElementById("paymentModal").style.display = "none";  
}

document.getElementById("searchInput").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        searchProducts(); 
    }
});

function searchProducts() {
    const searchInput = document.getElementById("searchInput").value.toLowerCase();

    const availableProducts = document.querySelectorAll(".available-section .product-item");
    const recommendedProducts = document.querySelectorAll(".recommendations .product-item");

    let productFound = false;

    function tryOpenModal(product) {
        const productName = product.querySelector("p").innerText.toLowerCase();
        if (productName.includes(searchInput)) {
            const imageSrc = product.querySelector("img").src;
            const price = product.getAttribute('data-price');
            const requiresSize = product.getAttribute('data-requires-size') === 'true';
            const maxQty = product.getAttribute('data-max-qty') || 10; 

            openModal(imageSrc, product.querySelector("p").innerText, price, requiresSize, maxQty);
            productFound = true;
        }
    }

    availableProducts.forEach(product => {
        tryOpenModal(product);
    });

    if (!productFound) {
        recommendedProducts.forEach(product => {
            tryOpenModal(product);
        });
    }

    if (!productFound) {
        alert("Product not found!"); 
    }
}

document.addEventListener("DOMContentLoaded", function() {
    const userRole = localStorage.getItem('userRole');
    if (!userRole) {
        window.location.href = 'login.html'; 
    } else if (userRole === 'admin') {
        alert('You are logged in as an Admin. You will be redirected to the admin panel.');
        window.location.href = 'admin.html'
    }
});

// News slider functionality
function showSlides(n) {
    let slides = document.getElementsByClassName("news-slide");
    if (n >= slides.length) {
        slideIndex = 0;
    }
    if (n < 0) {
        slideIndex = slides.length - 1;
    }
    for (let i = 0; i < slides.length; i++) {
        slides[i].style.display = "none"; 
    }
    slides[slideIndex].style.display = "block"; 
}

function moveSlide(n) {
    slideIndex += n;
    showSlides(slideIndex);
}


setInterval(function() {
    moveSlide(1); 
}, 4000);

function toggleProfileDropdown() {
    const dropdown = document.getElementById("profileDropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}

function openProfileModal() {
    document.getElementById('profileModal').style.display = 'block';
}

function closeProfileModal() {
    document.getElementById('profileModal').style.display = 'none';
}

window.addEventListener('click', function(event) {
    if (!event.target.matches('.user-icon')) {
        const dropdown = document.getElementById("profileDropdown");
        if (dropdown.style.display === "block") {
            dropdown.style.display = "none";
        }
    }
});

function logout() {
    localStorage.removeItem('userRole');
    window.location.href = 'login.html';
}

const hamMenu = document.querySelector(".ham-menu");

const offScreenMenu = document.querySelector(".off-screen-menu");

hamMenu.addEventListener("click", () => {
  hamMenu.classList.toggle("active");
  offScreenMenu.classList.toggle("active");
});
    </script>

</body>
</html>